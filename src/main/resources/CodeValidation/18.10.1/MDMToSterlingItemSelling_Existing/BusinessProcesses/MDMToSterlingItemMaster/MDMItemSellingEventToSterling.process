<?xml version="1.0" encoding="UTF-8"?>
<pd:ProcessDefinition xmlns:pfx="http://mdm.wsgc.com/2014/CanonicalData" xmlns:ns="http://www.tibco.com/namespaces/tnt/plugins/jms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ns1="http://www.tibco.com/pe/DeployedVarsType" xmlns:ns2="http://www.tibco.com/pe/EngineTypes" xmlns:tib="http://www.tibco.com/bw/xslt/custom-functions" xmlns:ns3="http://www.ultimosoft.com/CLEH/ExceptionHandler.xsd" xmlns:ns4="http://www.yantra.com/documentation/YCM/manageItem/input" xmlns:pfx2="http://www.tibco.com/schemas/EXTITEMATTRIBUTESTOPKMS/Schemas/Schema.xsd" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:pfx3="http://www.wsgc.com/schemas/common/AppAuditSwitches.xsd" xmlns:pd="http://xmlns.tibco.com/bw/process/2003" xmlns:BW="java://com.tibco.pe.core.JavaCustomXPATHFunctions">
    <xsd:import namespace="http://www.tibco.com/schemas/EXTITEMATTRIBUTESTOPKMS/Schemas/Schema.xsd" schemaLocation="/Schemas_OMSD2/PkMSFeed/MDM_Feed1.xsd"/>
    <xsd:import namespace="http://mdm.wsgc.com/2014/CanonicalData" schemaLocation="/SharedResources/XMLSchemas/eCommerce/OMSD2/2014-MDM-OMSD2/2014/CanonicalData/ItemSellingEvent.xsd"/>
    <pd:name>BusinessProcesses/MDMToSterlingItemMaster/MDMItemSellingEventToSterling.process</pd:name>
    <pd:startName>Receive_ItemSelling_Message_from_MDM</pd:startName>
    <pd:startX>0</pd:startX>
    <pd:startY>0</pd:startY>
    <pd:returnBindings/>
    <pd:starter name="Receive_ItemSelling_Message_from_MDM">
        <pd:type>com.tibco.plugin.jms.JMSQueueEventSource</pd:type>
        <pd:resourceType>ae.activities.JMSQueueEventSource</pd:resourceType>
        <pd:x>153</pd:x>
        <pd:y>81</pd:y>
        <config>
            <PermittedMessageType>Text</PermittedMessageType>
            <SessionAttributes>
                <transacted>false</transacted>
                <acknowledgeMode>2</acknowledgeMode>
                <maxSessions>%%MDMToSterlingItemMaster/JMS/EMSConstants/MaxSessions%%</maxSessions>
                <destination>%%PrefixQueue%%.%%ENV%%.%%MDMToSterlingItemMaster/JMS/ItemSelling_InputQueue%%</destination>
            </SessionAttributes>
            <ConfigurableHeaders>
                <JMSDeliveryMode>PERSISTENT</JMSDeliveryMode>
                <JMSExpiration>0</JMSExpiration>
                <JMSPriority>4</JMSPriority>
            </ConfigurableHeaders>
            <ConnectionReference>/SharedConnections/JMS/EMSMain.sharedjmscon</ConnectionReference>
            <ApplicationProperties>/SharedResources/JMSApplicationProperties/MDM-JMSApplicationProperties.sharedjmsapp</ApplicationProperties>
            <_sequenceKey>ns:ActivityOutput/OtherProperties/ItemId</_sequenceKey>
        </config>
        <pd:inputBindings/>
    </pd:starter>
    <pd:endName>End</pd:endName>
    <pd:endX>761</pd:endX>
    <pd:endY>81</pd:endY>
    <pd:errorSchemas/>
    <pd:processVariables/>
    <pd:targetNamespace>http://xmlns.example.com/1418040871407</pd:targetNamespace>
    <pd:activity name="CatchAll">
        <pd:type>com.tibco.pe.core.CatchActivity</pd:type>
        <pd:resourceType>ae.activities.catch</pd:resourceType>
        <pd:x>528</pd:x>
        <pd:y>179</pd:y>
        <pd:handler>true</pd:handler>
        <config>
            <catchAll>true</catchAll>
        </config>
        <pd:inputBindings/>
    </pd:activity>
    <pd:activity name="ConfirmOnError">
        <pd:type>com.tibco.pe.core.ConfirmActivity</pd:type>
        <pd:resourceType>activity.confirm</pd:resourceType>
        <pd:x>757</pd:x>
        <pd:y>179</pd:y>
        <config>
            <ConfirmEvent>Receive_ItemSelling_Message_from_MDM</ConfirmEvent>
        </config>
        <pd:inputBindings/>
    </pd:activity>
    <pd:activity name="ConfirmOnSuccess">
        <pd:type>com.tibco.pe.core.ConfirmActivity</pd:type>
        <pd:resourceType>activity.confirm</pd:resourceType>
        <pd:x>649</pd:x>
        <pd:y>81</pd:y>
        <config>
            <ConfirmEvent>Receive_ItemSelling_Message_from_MDM</ConfirmEvent>
        </config>
        <pd:inputBindings/>
    </pd:activity>
    <pd:activity name="GetTransactionID">
        <pd:type>com.tibco.pe.core.GetSharedVariableActivity</pd:type>
        <pd:resourceType>ae.activities.getSharedVariable</pd:resourceType>
        <pd:x>401</pd:x>
        <pd:y>81</pd:y>
        <config>
            <variableConfig>/SharedResources/SharedVariables/JSV-TransactionID.jobsharedvariable</variableConfig>
        </config>
        <pd:inputBindings/>
    </pd:activity>
    <pd:activity name="ItemSelling_SubProcess">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>519</pd:x>
        <pd:y>81</pd:y>
        <config>
            <processName>/BusinessProcesses/MDMToSterlingItemMaster/SubProcesses/MapToItemSelling.process</processName>
        </config>
        <pd:inputBindings>
            <SellingXML>
                <xsl:value-of select="$Receive_ItemSelling_Message_from_MDM/ns:ActivityOutput/Body"/>
            </SellingXML>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SendExceptionRequest">
        <pd:type>com.tibco.pe.core.CallProcessActivity</pd:type>
        <pd:resourceType>ae.process.subprocess</pd:resourceType>
        <pd:x>643</pd:x>
        <pd:y>179</pd:y>
        <config>
            <processName>/CommonProcesses/CLEClientStub/SendExceptionRequest.process</processName>
            <spawn>true</spawn>
        </config>
        <pd:inputBindings>
            <ns3:ExceptionHandlerRequest>
                <ns3:envCode>
                    <xsl:value-of select="$_globalVariables/ns1:GlobalVariables/ENV"/>
                </ns3:envCode>
                <ns3:appCode>
                    <xsl:value-of select="$_globalVariables/ns1:GlobalVariables/CLE/AppCode"/>
                </ns3:appCode>
                <ns3:interfaceCode>
                    <xsl:value-of select="$_globalVariables/ns1:GlobalVariables/MDMToSterlingItemMaster/CLE/InterfaceCode"/>
                </ns3:interfaceCode>
                <ns3:hostName>
                    <xsl:value-of select="BW:getHostName()"/>
                </ns3:hostName>
                <ns3:notificationList>
                    <xsl:value-of select="$_globalVariables/ns1:GlobalVariables/MDMToSterlingItemMaster/CLE/NotificationList"/>
                </ns3:notificationList>
                <ns3:timeStamp>
                    <xsl:value-of select="current-dateTime()"/>
                </ns3:timeStamp>
                <ns3:activityName>
                    <xsl:value-of select="tib:substring-after-last($_error/ns2:ErrorReport/ProcessStack, &quot;/&quot;)"/>
                </ns3:activityName>
                <ns3:message>
                    <xsl:value-of select="$_globalVariables/ns1:GlobalVariables/MDMToSterlingItemMaster/Exceptions/GeneralException/ExceptionMsg"/>
                </ns3:message>
                <ns3:payload>
                    <xsl:value-of select="$Receive_ItemSelling_Message_from_MDM/ns:ActivityOutput/Body"/>
                </ns3:payload>
                <ns3:ErrorLevel>
                    <ns3:errorCode>
                        <xsl:value-of select="$_globalVariables/ns1:GlobalVariables/MDMToSterlingItemMaster/Exceptions/GeneralException/ExceptionCode"/>
                    </ns3:errorCode>
                </ns3:ErrorLevel>
                <ns3:TransactionDetails>
                    <ns3:transactionDomain>
                        <xsl:value-of select="$_globalVariables/ns1:GlobalVariables/MDMToSterlingItemMaster/CLE/transactionDomain"/>
                    </ns3:transactionDomain>
                    <ns3:transactionType>
                        <xsl:value-of select="$_globalVariables/ns1:GlobalVariables/MDMToSterlingItemMaster/CLE/transactionType_ItemSelling"/>
                    </ns3:transactionType>
                    <ns3:transactionID>
                        <xsl:value-of select="$GetTransactionID/TransactionID"/>
                    </ns3:transactionID>
                </ns3:TransactionDetails>
                <xsl:for-each select="$_processContext/ns2:ProcessContext">
                    <ns3:ProcessContextDetails>
                        <ns3:processId>
                            <xsl:value-of select="ProcessId"/>
                        </ns3:processId>
                        <ns3:projectName>
                            <xsl:value-of select="ProjectName"/>
                        </ns3:projectName>
                        <ns3:engineName>
                            <xsl:value-of select="EngineName"/>
                        </ns3:engineName>
                        <ns3:restartedFromCheckpoint>
                            <xsl:value-of select="RestartedFromCheckpoint"/>
                        </ns3:restartedFromCheckpoint>
                        <xsl:for-each select="TrackingInfo">
                            <ns3:trackingInfo>
                                <xsl:value-of select="."/>
                            </ns3:trackingInfo>
                        </xsl:for-each>
                    </ns3:ProcessContextDetails>
                </xsl:for-each>
                <xsl:for-each select="$_error/ns2:ErrorReport">
                    <ns3:ErrorReportType>
                        <ns3:stackTrace>
                            <xsl:value-of select="StackTrace"/>
                        </ns3:stackTrace>
                        <ns3:msg>
                            <xsl:value-of select="Msg"/>
                        </ns3:msg>
                        <ns3:fullClass>
                            <xsl:value-of select="FullClass"/>
                        </ns3:fullClass>
                        <ns3:class>
                            <xsl:value-of select="Class"/>
                        </ns3:class>
                        <ns3:processStack>
                            <xsl:value-of select="ProcessStack"/>
                        </ns3:processStack>
                        <xsl:if test="MsgCode">
                            <ns3:msgCode>
                                <xsl:value-of select="MsgCode"/>
                            </ns3:msgCode>
                        </xsl:if>
                        <xsl:if test="Data/*">
                            <ns3:data>
                                <xsl:value-of select="Data/*"/>
                            </ns3:data>
                        </xsl:if>
                    </ns3:ErrorReportType>
                </xsl:for-each>
            </ns3:ExceptionHandlerRequest>
        </pd:inputBindings>
    </pd:activity>
    <pd:activity name="SetTransactionID">
        <pd:type>com.tibco.pe.core.SetSharedVariableActivity</pd:type>
        <pd:resourceType>ae.activities.setSharedVariable</pd:resourceType>
        <pd:x>281</pd:x>
        <pd:y>81</pd:y>
        <config>
            <variableConfig>/SharedResources/SharedVariables/JSV-TransactionID.jobsharedvariable</variableConfig>
        </config>
        <pd:inputBindings>
            <TransactionID>
                <xsl:value-of select="if (contains($Receive_ItemSelling_Message_from_MDM/ns:ActivityOutput/Body, 'ItemSelling'))&#xA;then &#xA;tib:trim(substring-before(substring-after(substring($Receive_ItemSelling_Message_from_MDM/ns:ActivityOutput/Body,  tib:index-of($Receive_ItemSelling_Message_from_MDM/ns:ActivityOutput/Body, 'itemId')), '&quot;'), '&quot;'))&#xA;else if &#xA;(string-length(tib:substring-before-last(substring-after($Receive_ItemSelling_Message_from_MDM/ns:ActivityOutput/Body, &quot;&lt;TransactionId>&quot;), &quot;&lt;/TransactionId>&quot;))>0) &#xA;then &#xA;normalize-space(tib:substring-before-last(substring-after($Receive_ItemSelling_Message_from_MDM/ns:ActivityOutput/Body, &quot;&lt;TransactionId>&quot;), &quot;&lt;/TransactionId>&quot;))&#xA;else &#xA;concat($_processContext/ns2:ProcessContext/ProcessId, current-dateTime())"/>
            </TransactionID>
        </pd:inputBindings>
    </pd:activity>
    <pd:transition>
        <pd:from>ConfirmOnSuccess</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>CatchAll</pd:from>
        <pd:to>SendExceptionRequest</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SendExceptionRequest</pd:from>
        <pd:to>ConfirmOnError</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>ConfirmOnError</pd:from>
        <pd:to>End</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>ItemSelling_SubProcess</pd:from>
        <pd:to>ConfirmOnSuccess</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>Receive_ItemSelling_Message_from_MDM</pd:from>
        <pd:to>SetTransactionID</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>SetTransactionID</pd:from>
        <pd:to>GetTransactionID</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:transition>
        <pd:from>GetTransactionID</pd:from>
        <pd:to>ItemSelling_SubProcess</pd:to>
        <pd:lineType>Default</pd:lineType>
        <pd:lineColor>-16777216</pd:lineColor>
        <pd:conditionType>always</pd:conditionType>
    </pd:transition>
    <pd:label>
        <pd:name>Label</pd:name>
        <pd:description>Main process to receive ItemSelling Xml message from MDM.</pd:description>
        <pd:x>354</pd:x>
        <pd:y>31</pd:y>
        <pd:width>369</pd:width>
        <pd:height>48</pd:height>
        <pd:fontColor>-16777216</pd:fontColor>
        <pd:color>-3342337</pd:color>
        <pd:type>solid</pd:type>
        <pd:thickness>0</pd:thickness>
        <pd:fade>true</pd:fade>
    </pd:label>
</pd:ProcessDefinition>